<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Make you own junction &mdash; myQLM documentation  documentation</title>
      <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../../static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
    <link rel="shortcut icon" href="../../../static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../static/documentation_options.js"></script>
        <script src="../../../static/jquery.js"></script>
        <script src="../../../static/underscore.js"></script>
        <script src="../../../static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../static/doctools.js"></script>
        <script src="../../../static/sphinx_highlight.js"></script>
        <script src="../../../static/design-tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Getting information from the QPU" href="03_hardware_specs.html" />
    <link rel="prev" title="Make your own plugin" href="01_custom_plugin.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> myQLM documentation
            <img src="../../../static/myqlm-doc-logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.10.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../01_getting_started.html">Getting started</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../02_user_guide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../01_write.html">Writing quantum programs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../02_execute.html">Executing / Simulating quantum programs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../01_job.html">Constructing one or multiple Jobs (using Batch)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02_result.html">Result of a quantum program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03_qpu.html">Quantum Processing Unit (QPU)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../04_plugin.html">Extending a QPU (by using Plugins)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="01_custom_plugin.html">Make your own plugin</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Make you own junction</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#a-concrete-example">A concrete example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="03_hardware_specs.html">Getting information from the QPU</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../05_variational.html">Running variational algorithms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../02_user_guide.html#libraries-built-upon-qaptiva">Libraries built upon Qaptiva</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../04_api_reference.html">API reference</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../05_demos.html">Demos</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../%3Amyqlm%3A06_support.html">Contributing to myQLM</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../07_release_notes.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">myQLM documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../02_user_guide.html">User guide</a> &raquo;</li>
          <li><a href="../../02_execute.html">Executing / Simulating quantum programs</a> &raquo;</li>
          <li><a href="../04_plugin.html">Extending a QPU (by using Plugins)</a> &raquo;</li>
      <li>Make you own junction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="make-you-own-junction">
<span id="custom-junction"></span><h1>Make you own junction<a class="headerlink" href="#make-you-own-junction" title="Permalink to this heading"></a></h1>
<p>If <strong>Plugins</strong> can be seen as two-way pipes that transform quantum programs on the way in and execution result on the way back, <strong>Junction</strong>
can be seen as, well, junctions, in this piping system. More precisely, they provide a simple interface to embed repeated, adaptive,
classical computations in the middle on the execution stack.</p>
<p>The simpler, and most widely used example would the one of a variational optimizer dealing with a variational eigensolving procedure.
In this setting, the incoming <a class="reference internal" href="../../../04_api_reference/module_qat/module_core/job.html#qat.core.Job" title="qat.core.Job"><code class="xref py py-class docutils literal notranslate"><span class="pre">Job</span></code></a> is an <em>“abstract”</em> job with open angles or variables. The optimizer would like to
start and iteratively give these angles some value, evaluate the energy for this set of values and iterate until satfisfied.
Of couse, it is completely possible to deal with this type of routines outside of the Qaptiva stack, but this might prevent some optimized
workflow where the job is first compiled and optimized for a given architecture and only then enters the variational solver.</p>
<p>With junctions, it is rather trivial to embed any such adaptive treatment after the compilation and optimization stage of the stack. In our
framework, a junction should inherit from <a class="reference internal" href="../../../04_api_reference/module_qat/module_plugins/junction.html#qat.plugins.Junction" title="qat.plugins.Junction"><code class="xref py py-class docutils literal notranslate"><span class="pre">qat.plugins.Junction</span></code></a> and must define method <a class="reference internal" href="../../../04_api_reference/module_qat/module_plugins/junction.html#qat.plugins.Junction.run" title="qat.plugins.Junction.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run()</span></code></a>
.
This method can perform as many call to the <a class="reference internal" href="../../../04_api_reference/module_qat/module_plugins/junction.html#qat.plugins.Junction.execute" title="qat.plugins.Junction.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code></a> method which submits a <a class="reference internal" href="../../../04_api_reference/module_qat/module_core/job.html#qat.core.Job" title="qat.core.Job"><code class="xref py py-class docutils literal notranslate"><span class="pre">Job</span></code></a> to
the QPU and return the computed <a class="reference internal" href="../../../04_api_reference/module_qat/module_core/result.html#qat.core.Result" title="qat.core.Result"><code class="xref py py-class docutils literal notranslate"><span class="pre">Result</span></code></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If your Junction implement its own constructor, please ensure the parent constructor is called</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qat.plugins</span> <span class="kn">import</span> <span class="n">Junction</span>

<span class="k">class</span> <span class="nc">IterativeExploration</span><span class="p">(</span><span class="n">Junction</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">23</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span> <span class="o">=</span> <span class="n">nsteps</span>
</pre></div>
</div>
</div>
<section id="a-concrete-example">
<h2>A concrete example<a class="headerlink" href="#a-concrete-example" title="Permalink to this heading"></a></h2>
<p>In the following example, we will construct a quite naive junction that will process a quantum circuit with a single parameter and
iteratively try all the values for this parameter with some step width. After having explored the search space, it will return the best
(i.e least) ecountered value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qat.plugins</span> <span class="kn">import</span> <span class="n">Junction</span>
<span class="kn">from</span> <span class="nn">qat.core</span> <span class="kn">import</span> <span class="n">Result</span>

<span class="k">class</span> <span class="nc">IterativeExploration</span><span class="p">(</span><span class="n">Junction</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="mi">23</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span> <span class="o">=</span> <span class="n">nsteps</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_job</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">):</span>
        <span class="n">job</span> <span class="o">=</span> <span class="n">initial_job</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">get_variables</span><span class="p">()</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nsteps</span><span class="p">)</span>
        <span class="n">all_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
            <span class="n">current_job</span> <span class="o">=</span> <span class="n">job</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">variable</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">current_job</span><span class="p">)</span>
            <span class="n">all_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">all_values</span><span class="p">)</span>
        <span class="n">best_index</span> <span class="o">=</span> <span class="n">all_values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">min_val</span><span class="p">)</span>
        <span class="n">best_param</span> <span class="o">=</span> <span class="n">angles</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">min_val</span><span class="p">,</span> <span class="n">parameter_map</span><span class="o">=</span><span class="p">{</span><span class="n">variable</span><span class="p">:</span> <span class="n">best_param</span><span class="p">})</span>
</pre></div>
</div>
<p><strong>So how does it work?</strong>
The <em>run</em> method is the entry point of our repeated procedure. This method will be called by the junction upon reception
of a new abstract job from the higher part of the stack. It receives an incoming job and the associated meta data
(in case you would like to offer some additional control to the user submitting the job).
You can write anything you want inside this method. In addition, the junction interface gives you acces to another method:
the <a class="reference internal" href="../../../04_api_reference/module_qat/module_plugins/junction.html#qat.plugins.Junction.execute" title="qat.plugins.Junction.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">execute()</span></code></a> method. This method can be seen as a <a class="reference internal" href="../../../04_api_reference/module_qat/module_qpus/qpuhandler.html#qat.qpus.QPUHandler.submit" title="qat.qpus.QPUHandler.submit"><code class="xref py py-class docutils literal notranslate"><span class="pre">submit</span></code></a> method.
It takes a qlm job and transmit it down to the rest of the stack and get back the result.</p>
<p>On our example, we simply iteratively bind the value of the parameter (using the overloaded <em>__call__</em> operator of the Job object),
execute this job and store the result in a list.</p>
<p>Notice also that we need to return a proper Qaptiva result object. This is so that the result can be, in turn, post processed by the upper part of the stack. Indeed, a <strong>Junction</strong> can be piped to any Qaptiva <strong>Plugin</strong> or <strong>QPU</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qat.qpus</span> <span class="kn">import</span> <span class="n">get_default_qpu</span>

<span class="c1"># Building a simple stack</span>
<span class="n">qpu</span> <span class="o">=</span> <span class="n">get_default_qpu</span><span class="p">()</span>
<span class="n">stack</span> <span class="o">=</span> <span class="n">IterativeExploration</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="o">|</span> <span class="n">qpu</span>
</pre></div>
</div>
<p>This QPU stack accept variational jobs an optimize the angle to minimize the average value of the observable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># and a simple job</span>
<span class="kn">from</span> <span class="nn">qat.core</span> <span class="kn">import</span> <span class="n">Observable</span>
<span class="kn">from</span> <span class="nn">qat.lang</span> <span class="kn">import</span> <span class="n">qrout</span><span class="p">,</span> <span class="n">RY</span>

<span class="nd">@qrout</span>
<span class="k">def</span> <span class="nf">variational_circ</span><span class="p">(</span><span class="n">beta</span><span class="p">):</span>
    <span class="n">RY</span><span class="p">(</span><span class="n">beta</span><span class="p">)(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">job</span> <span class="o">=</span> <span class="n">variational_circ</span><span class="o">.</span><span class="n">to_job</span><span class="p">(</span><span class="n">observable</span><span class="o">=</span><span class="n">Observable</span><span class="o">.</span><span class="n">sigma_z</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best value:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;for beta =&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">parameter_map</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Best</span> <span class="n">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.9979453927503363</span> <span class="k">for</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">3.077478517802246</span>
</pre></div>
</div>
<p>If you don’t want to bother with the (quite low) administrative burden of binding the variables and extracting the value attribute,
the <a class="reference internal" href="../../../04_api_reference/module_qat/module_plugins/optimizer.html#qat.plugins.Optimizer" title="qat.plugins.Optimizer"><code class="xref py py-class docutils literal notranslate"><span class="pre">qat.plugins.Optimizer</span></code></a> class provides a slightly simpler API that particularizes the junction API to fit to the one required
by most variational optimizers (see the source code documentation for more precisions).</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01_custom_plugin.html" class="btn btn-neutral float-left" title="Make your own plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="03_hardware_specs.html" class="btn btn-neutral float-right" title="Getting information from the QPU" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Eviden 2016-2024.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>